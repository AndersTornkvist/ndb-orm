<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
</head>
<body>
<h1 id="python-ndb-orm">Python-NDB-ORM</h1>
<p>NDB-ORM is a python3 compatible orm for google cloud datastore based on ndb.model (created by Guido van Rossum) and may be used outside of app engine standard environment.</p>
<ul>
<li>Plays nicely with datastore entities generated from app engine standard</li>
<li>Python3 compatible</li>
<li>Usable from outside of app engine standard</li>
<li>Based on the original ndb package</li>
<li>Protobuffer implementation was ported to google.cloud.proto.datastore.v1.entity_pb2 (which is also used by gcloud-datastore-python)</li>
<li>No dependencies to old appengine libraries</li>
<li>Makes porting of app engine standard project easier</li>
<li>Works with <a href="https://pypi.python.org/pypi/google-cloud-datastore">google-cloud-datastore</a></li>
<li>Key handling is used from google.cloud.datastore</li>
</ul>
<p>This is not a drop-in replacement for the whole ndb package (no ndb.context, ndb.tasklets, ndb.query or ndb.Key), but allows you to use ndb.model classes.</p>
<p>For more details of all the possobilities of the ndb.model orm, plead have a look at &quot;<a href="https://cloud.google.com/appengine/docs/standard/python/ndb/">The Python NDB Client Library Overview</a>&quot;.</p>
<h2 id="attention">ATTENTION</h2>
<p>While reading of entities generated with app engine standard should be no problem, threre are limitations reading entities written with this package (also also with google-cloud-datastore) from app engine standard. The reason is that some types have changed format (e.g. datetime properties with google-cloud-datastore support timezones).</p>
<p>Additional (as you might have expected) using the PickleProperty between different Python version is expected to fail and thus pickle.loads is disabled by default. You can enable it by setting ndb_orm.model.ENABLE_PICKLE_LOADS to True.</p>
<h2 id="quick-start">Quick Start</h2>
<p>$ pip install --upgrade ndb-orm</p>
<h2 id="simple-example-session-with-google-cloud-datastore">Simple example session with google-cloud-datastore</h2>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co"># creating an entity with google-cloud-datastore</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>

<span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> google.cloud <span class="im">import</span> datastore
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> client <span class="op">=</span> datastore.Client()
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> kind <span class="op">=</span> <span class="st">&#39;Task&#39;</span> <span class="co"># The kind for the new entity</span>
<span class="op">&gt;&gt;&gt;</span> name <span class="op">=</span> <span class="st">&#39;sampletask&#39;</span> <span class="co"># The name/ID for the new entity</span>
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> key <span class="op">=</span> client.key(kind, name) <span class="co"># The Cloud Datastore key for the new entity</span>
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> entity <span class="op">=</span> datastore.Entity(key<span class="op">=</span>key, exclude_from_indexes<span class="op">=</span>(<span class="st">&#39;text&#39;</span>,))
<span class="op">&gt;&gt;&gt;</span> entity.update({
...     <span class="st">&#39;text&#39;</span>: <span class="st">&#39;Much to do&#39;</span>,
...     <span class="st">&#39;done&#39;</span>: <span class="va">False</span>,
... })
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> client.put(entity)

<span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co"># getting the entity as ndb.Model by defining an entity &#39;Task&#39; and enabling ndb_orm</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>

<span class="op">&gt;&gt;&gt;</span> <span class="im">import</span> ndb_orm <span class="im">as</span> ndb
<span class="op">&gt;&gt;&gt;</span> ndb.enable_use_with_gcd(client.project)
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> <span class="kw">class</span> Task(ndb.Model):
...     text <span class="op">=</span> ndb.TextProperty(indexed<span class="op">=</span><span class="va">False</span>)
...     done <span class="op">=</span> ndb.BooleanProperty()
...     update <span class="op">=</span> ndb.DateTimeProperty(auto_now<span class="op">=</span><span class="va">True</span>)
<span class="op">&gt;&gt;&gt;</span> 
<span class="op">&gt;&gt;&gt;</span> entity <span class="op">=</span> client.get(key) <span class="co"># now get get an ndb model for the same data ! </span>
<span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(entity)
Task(key<span class="op">=&lt;</span>Key(<span class="st">&#39;Task&#39;</span>, <span class="st">&#39;sampletask&#39;</span>)<span class="op">&gt;</span>, done<span class="op">=</span><span class="va">False</span>, text<span class="op">=</span><span class="st">&#39;Much to do&#39;</span>)
<span class="op">&gt;&gt;&gt;</span>
<span class="op">&gt;&gt;&gt;</span> client.put(entity) <span class="co"># save entity (and &#39;update&#39; property gets set automatically)</span>
<span class="op">&gt;&gt;&gt;</span>
<span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(client.get(key)) <span class="co"># get entity with &#39;update&#39; property set</span>
Task(key<span class="op">=&lt;</span>Key(<span class="st">&#39;Task&#39;</span>, <span class="st">&#39;sampletask&#39;</span>)<span class="op">&gt;</span>, done<span class="op">=</span><span class="va">False</span>, text<span class="op">=</span><span class="st">&#39;Much to do&#39;</span>, update<span class="op">=</span>datetime.datetime(<span class="dv">2017</span>, <span class="dv">8</span>, <span class="dv">28</span>, <span class="dv">22</span>, <span class="dv">16</span>, <span class="dv">15</span>, <span class="dv">652839</span>, tzinfo<span class="op">=&lt;</span>UTC<span class="op">&gt;</span>))
 
<span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co"># access to this entity without ndb-orm still possible</span>
<span class="op">&gt;&gt;&gt;</span> <span class="co">#</span>

<span class="op">&gt;&gt;&gt;</span> ndb.enable_use_with_gcd() <span class="co"># disable ndb-orm - now we wont receive a ndb.Model anymore</span>
 
<span class="op">&gt;&gt;&gt;</span> <span class="bu">print</span>(client.get(key)) <span class="co"># a normale get still works without ndb-orm</span>
<span class="op">&lt;</span>Entity(<span class="st">&#39;Task&#39;</span>, <span class="st">&#39;sampletask&#39;</span>) {<span class="st">&#39;done&#39;</span>: <span class="va">False</span>, <span class="st">&#39;update&#39;</span>: datetime.datetime(<span class="dv">2017</span>, <span class="dv">8</span>, <span class="dv">28</span>, <span class="dv">22</span>, <span class="dv">16</span>, <span class="dv">15</span>, <span class="dv">652839</span>, tzinfo<span class="op">=&lt;</span>UTC<span class="op">&gt;</span>), <span class="st">&#39;text&#39;</span>: <span class="st">&#39;Much to do&#39;</span>}<span class="op">&gt;</span>
<span class="op">&gt;&gt;&gt;</span> </code></pre></div>
<p>Most property types should work just fine. Even the StructuedProperty class, and keywords 'indexed', 'repeated', 'compression', 'name' and 'required' should work as well.</p>
<p>Enjoy this beautiful ORM !</p>
<h2 id="public-repository">Public repository</h2>
<p>https://github.com/berlincode/ndb-orm</p>
<h2 id="license">License</h2>
<p>Copyright &quot;the ndb authors&quot; and Ulf Bartel. Code is licensed under the <a href="./LICENSE.txt">Apache 2.0</a>.</p>
</body>
</html>
